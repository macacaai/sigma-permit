<div class="table-responsive">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>Device</th>
                <th>IP Address</th>
                <th>Status</th>
                <th>Created</th>
                <th>Last Activity</th>
                <th>Expires</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for session in sessions %}
            <tr>
                <td>
                    <div>
                        <strong>{{ session.device_info.browser|title if session.device_info.browser else 'Unknown' }}</strong>
                        <br>
                        <small class="text-muted">
                            {{ session.device_info.os|title if session.device_info.os else 'Unknown OS' }} â€¢
                            {{ session.device_info.device_type|title if session.device_info.device_type else 'Unknown' }}
                        </small>
                    </div>
                </td>
                <td>{{ session.ip_address or 'Unknown' }}</td>
                <td>
                    {% if session.is_active and session.expires_at > datetime.utcnow() %}
                        <span class="badge bg-success">Active</span>
                    {% elif not session.is_active %}
                        <span class="badge bg-secondary">Inactive</span>
                    {% else %}
                        <span class="badge bg-warning">Expired</span>
                    {% endif %}
                </td>
                <td>{{ session.created_at.strftime('%m/%d %H:%M') }}</td>
                <td>{{ session.last_activity.strftime('%m/%d %H:%M') if session.last_activity else '-' }}</td>
                <td>
                    {% if session.expires_at > datetime.utcnow() %}
                        <span class="text-success">{{ session.expires_at.strftime('%m/%d %H:%M') }}</span>
                    {% else %}
                        <span class="text-danger">{{ session.expires_at.strftime('%m/%d %H:%M') }}</span>
                    {% endif %}
                </td>
                <td>
                    <div class="btn-group" role="group">
                        {% if session.is_active and session.expires_at > datetime.utcnow() %}
                        <button class="btn btn-sm btn-outline-primary" onclick="extendSession('{{ session.session_id }}')" title="Extend Session">
                            <i class="bx bx-time"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="terminateSession('{{ session.session_id }}')" title="Terminate">
                            <i class="bx bx-x"></i>
                        </button>
                        {% else %}
                        <span class="text-muted small">N/A</span>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Empty state -->
{% if not sessions %}
<div class="text-center py-5">
    <i class="bx bx-time display-1 text-muted"></i>
    <h4 class="mt-3">No Sessions Found</h4>
    <p class="text-muted">{% if active_only %}No active sessions found.{% else %}No sessions found for the selected criteria.{% endif %}</p>
</div>
{% endif %}

<!-- Pagination -->
{% if pages > 1 %}
<nav aria-label="Sessions pagination">
    <ul class="pagination justify-content-center">
        {% if page > 1 %}
        <li class="page-item">
            <a class="page-link" href="#" onclick="changePage({{ page - 1 }})">Previous</a>
        </li>
        {% endif %}

        {% for page_num in range(max(1, page - 2), min(pages + 1, page + 3)) %}
        <li class="page-item {% if page_num == page %}active{% endif %}">
            <a class="page-link" href="#" onclick="changePage({{ page_num }})">{{ page_num }}</a>
        </li>
        {% endfor %}

        {% if page < pages %}
        <li class="page-item">
            <a class="page-link" href="#" onclick="changePage({{ page + 1 }})">Next</a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endif %}

<!-- Results info -->
{% if sessions %}
<div class="mt-3 text-muted">
    Showing {{ ((page - 1) * size) + 1 }} to {{ min(page * size, total) }} of {{ total }} sessions
    {% if active_only %}
    <span class="badge bg-success ms-2">Active Only</span>
    {% endif %}
</div>
{% endif %}

<script>
function changePage(pageNum) {
    const activeOnly = document.getElementById('activeOnlyFilter').checked;
    const url = `/admin/identity/sessions/list?page=${pageNum}&size=10&active_only=${activeOnly}`;
    htmx.ajax('GET', url, {target: '#sessionsList'});
}

function extendSession(sessionId) {
    const hours = prompt('Extend session by how many hours? (1-24)', '8');
    if (hours && !isNaN(hours) && hours >= 1 && hours <= 24) {
        const minutes = parseInt(hours) * 60;
        fetch(`/api/v1/sessions/${sessionId}/extend?extension_minutes=${minutes}`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${getAuthToken()}`
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.id) {
                alert('Session extended successfully!');
                location.reload();
            } else {
                alert('Error: ' + (data.detail || 'Unknown error'));
            }
        })
        .catch(error => {
            alert('Error: ' + error.message);
        });
    }
}

function terminateSession(sessionId) {
    if (confirm('Are you sure you want to terminate this session?')) {
        fetch(`/api/v1/sessions/${sessionId}`, {
            method: 'DELETE',
            headers: {
                'Authorization': `Bearer ${getAuthToken()}`
            }
        })
        .then(response => {
            if (response.ok) {
                alert('Session terminated successfully!');
                location.reload();
            } else {
                alert('Error terminating session');
            }
        })
        .catch(error => {
            alert('Error: ' + error.message);
        });
    }
}

function getAuthToken() {
    // Get auth token from localStorage or wherever it's stored
    // This is a placeholder - implement based on your auth system
    return localStorage.getItem('auth_token') || '';
}
</script>