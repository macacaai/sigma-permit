var z=Object.defineProperty;var C=(e,t,r)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var j=(e,t,r)=>C(e,typeof t!="symbol"?t+"":t,r);import{a as N,t as V}from"./DQoX3H7n.js";import{B,a9 as D}from"./BM_9wLIj.js";import{d as I,w as q}from"./yobZMkJ7.js";function ce(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function ue(e,t){V(e,1,1,()=>{t.delete(e.key)})}function de(e,t,r,n,a,i,o,l,g,f,k,R){let h=e.length,y=i.length,c=h;const p={};for(;c--;)p[e[c].key]=c;const w=[],m=new Map,$=new Map,P=[];for(c=y;c--;){const u=R(a,i,c),T=r(u);let b=o.get(T);b?P.push(()=>b.p(u,t)):(b=f(T,u),b.c()),m.set(T,w[c]=b),T in p&&$.set(T,Math.abs(c-p[T]))}const A=new Set,F=new Set;function E(u){N(u,1),u.m(l,k),o.set(u.key,u),k=u.first,y--}for(;h&&y;){const u=w[y-1],T=e[h-1],b=u.key,L=T.key;u===T?(k=u.first,h--,y--):m.has(L)?!o.has(b)||A.has(b)?E(u):F.has(L)?h--:$.get(b)>$.get(L)?(F.add(b),E(u)):(A.add(L),h--):(g(T,o),h--)}for(;h--;){const u=e[h];m.has(u.key)||g(u,o)}for(;y;)E(w[y-1]);return B(P),w}function Q(e,t,r,n){var a,i,o=!1,l=r.length>=2,g=(c,p,w)=>{if(a=p,l&&(i=c),!o){let m=t(c,p,w);if(t.length<2)p(m);else return m}o=!1},f=I(e,g,n),k=!Array.isArray(e);function R(c){var p=r(c,i);k?(o=!0,e.set(p)):p.forEach((w,m)=>{o=!0,e[m].set(w)}),o=!1}var h=!1;function y(c){var p,w,m,$;if(h){$=c(D(f)),a($);return}var P=f.subscribe(A=>{h?p?w=!0:p=!0:m=A});$=c(m),h=!0,a($),P(),h=!1,w&&($=D(f)),p&&R($)}return{subscribe:f.subscribe,set(c){y(()=>c)},update:y}}const Y=20,S=q([]),_=q(null),U=new Map,H=e=>{if(U.has(e))return;const t=setTimeout(()=>{U.delete(e),x(e)},1e3);U.set(e,t)},J=e=>{const t=U.get(e);t&&clearTimeout(t)};function W(e){e.id&&J(e.id),S.update(t=>t.map(r=>r.id===e.id?{...r,...e}:r))}function G(e){S.update(t=>[e,...t].slice(0,Y))}function O(e){D(S).find(t=>t.id===e.id)?W(e):G(e)}function X(e){S.update(t=>(e?H(e):t.forEach(r=>{H(r.id)}),t.map(r=>r.id===e||e===void 0?{...r,visible:!1}:r)))}function x(e){S.update(t=>e===void 0?[]:t.filter(r=>r.id!==e))}function le(e){_.set(e)}function fe(e){let t;_.update(r=>(t=e-(r||0),null)),S.update(r=>r.map(n=>({...n,pauseDuration:n.pauseDuration+t})))}const Z={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3};function he(e={}){return{toasts:Q(S,r=>r.map(n=>{var a,i;return{...e,...e[n.type],...n,duration:n.duration||((a=e[n.type])==null?void 0:a.duration)||(e==null?void 0:e.duration)||Z[n.type],style:[e.style,(i=e[n.type])==null?void 0:i.style,n.style].join(";")}}),r=>r),pausedAt:_}}const K=e=>typeof e=="function",M=(e,t)=>K(e)?e(t):e,ee=(()=>{let e=0;return()=>(e+=1,e.toString())})(),pe=(()=>{let e;return()=>{if(e===void 0&&typeof window<"u"){const t=matchMedia("(prefers-reduced-motion: reduce)");e=!t||t.matches}return e}})(),te=(e,t="blank",r)=>({createdAt:Date.now(),visible:!0,type:t,ariaProps:{role:"status","aria-live":"polite"},message:e,pauseDuration:0,...r,id:(r==null?void 0:r.id)||ee()}),v=e=>(t,r)=>{const n=te(t,e,r);return O(n),n.id},d=(e,t)=>v("blank")(e,t);d.error=v("error");d.success=v("success");d.loading=v("loading");d.custom=v("custom");d.dismiss=e=>{X(e)};d.remove=e=>x(e);d.promise=(e,t,r)=>{const n=d.loading(t.loading,{...r,...r==null?void 0:r.loading});return e.then(a=>(d.success(M(t.success,a),{id:n,...r,...r==null?void 0:r.success}),a)).catch(a=>{d.error(M(t.error,a),{id:n,...r,...r==null?void 0:r.error})}),e};const re="/api";class se{constructor(t=re){j(this,"baseURL");this.baseURL=t}async request(t,r={},n=!0){const a=`${this.baseURL}${t}`,i={headers:{"Content-Type":"application/json",...this.getAuthHeaders(),...r.headers},...r};try{const o=await fetch(a,i);if(!o.ok){if(o.status===401&&n&&this.canRefreshToken())try{return await this.refreshAccessToken(),this.request(t,r,!1)}catch{throw this.logoutUser(),new Error("Your session has expired. Please login again.")}if(o.status===401)throw this.logoutUser(),new Error("Your session has expired. Please login again.");let f=(await o.json().catch(()=>({detail:`HTTP ${o.status}: ${o.statusText}`}))).detail||"An error occurred";throw o.status===403?f="You do not have permission to perform this action.":o.status===404?f="The requested resource was not found.":o.status===422?f="Invalid data provided. Please check your input.":o.status>=500&&(f="Server error. Please try again later."),d.error(f),new Error(f)}return await o.json()}catch(o){throw o instanceof Error&&o.message.includes("HTTP")?o:(d.error("Network error occurred"),new Error("Network error occurred"))}}async get(t,r){const n=r?`${t}?${new URLSearchParams(r).toString()}`:t;return this.request(n)}async post(t,r){return this.request(t,{method:"POST",body:r?JSON.stringify(r):void 0})}async postForm(t,r){const n=`${this.baseURL}${t}`;try{const a=await fetch(n,{method:"POST",body:r,headers:{...this.getAuthHeaders()}});if(!a.ok){const o=await a.json().catch(()=>({detail:`HTTP ${a.status}: ${a.statusText}`}));throw d.error(o.detail||"An error occurred"),new Error(o.detail||"An error occurred")}return await a.json()}catch(a){throw a instanceof Error&&a.message.includes("HTTP")?a:(d.error("Network error occurred"),new Error("Network error occurred"))}}async put(t,r){return this.request(t,{method:"PUT",body:r?JSON.stringify(r):void 0})}async delete(t){return this.request(t,{method:"DELETE"})}async downloadFile(t,r){const n=`${this.baseURL}${t}`;try{const a=await fetch(n,{headers:{...this.getAuthHeaders()}});if(!a.ok){const g=await a.json().catch(()=>({detail:`HTTP ${a.status}: ${a.statusText}`}));throw d.error(g.detail||"Download failed"),new Error(g.detail||"Download failed")}const i=await a.blob(),o=window.URL.createObjectURL(i),l=document.createElement("a");l.href=o,l.download=r||this.getFilenameFromResponse(a)||"download",document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(o),d.success("File downloaded successfully")}catch(a){throw console.error("Download error:",a),a instanceof Error&&!a.message.includes("HTTP")&&d.error("Download failed: "+a.message),a}}getAuthHeaders(){const t=sessionStorage.getItem("access_token");return t?{Authorization:`Bearer ${t}`}:{}}canRefreshToken(){return!!sessionStorage.getItem("refresh_token")}async refreshAccessToken(){const t=sessionStorage.getItem("refresh_token");if(!t)throw new Error("No refresh token available");const r=new URLSearchParams;r.append("refresh_token",t);const n=`${this.baseURL}/auth/refresh`,a=await fetch(n,{method:"POST",body:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!a.ok)throw new Error("Failed to refresh token");const i=await a.json();sessionStorage.setItem("access_token",i.access_token),sessionStorage.setItem("refresh_token",i.refresh_token)}logoutUser(){sessionStorage.removeItem("access_token"),sessionStorage.removeItem("refresh_token"),window.location.href="/login"}getFilenameFromResponse(t){const r=t.headers.get("content-disposition");if(r){const n=r.match(/filename="(.+)"/);if(n)return n[1]}return null}}const s=new se,ge={getTenants:(e=1,t=10)=>s.get(`/tenants?page=${e}&size=${t}`),getTenant:e=>s.get(`/tenants/${e}`),createTenant:e=>s.post("/tenants",e),updateTenant:(e,t)=>s.put(`/tenants/${e}`,t),deleteTenant:e=>s.delete(`/tenants/${e}`)},we={getTemplates:(e=1,t=10)=>s.get(`/templates?page=${e}&size=${t}`),getTemplate:e=>s.get(`/templates/${e}`),createTemplate:e=>s.post("/templates",e),updateTemplate:(e,t)=>s.put(`/templates/${e}`,t),deleteTemplate:e=>s.delete(`/templates/${e}`)},me={getLicenses:(e=1,t=10,r)=>{const n=new URLSearchParams({page:e.toString(),size:t.toString()});return r&&n.append("tenant_id",r),s.get(`/licenses?${n.toString()}`)},getLicense:e=>s.get(`/licenses/${e}`),createLicense:e=>s.post("/licenses",e),updateLicense:(e,t)=>s.put(`/licenses/${e}`,t),deleteLicense:e=>s.delete(`/licenses/${e}`),downloadLicense:async e=>{if(!e)throw new Error("License key is required for download");const t=btoa(e);return s.downloadFile(`/licenses/issue?encoded_license_key=${encodeURIComponent(t)}`)},validateFile:async(e,t)=>{if(!e)throw new Error("License key is required for validation");if(!t)throw new Error("License file is required for validation");const r=new FormData;return r.append("license_key",e),r.append("file",t),s.postForm("/licenses/validate-file",r)},generateValidator:e=>s.get(`/licenses/generate-validator?language=${e}`)},ye={login:async(e,t)=>{const r=btoa(`${e}:${t}`),n=new URLSearchParams;n.append("credentials",r);const a=`${s.baseURL}/auth/login`,i=await fetch(a,{method:"POST",body:n,headers:{"Content-Type":"application/x-www-form-urlencoded",...s.getAuthHeaders()}});if(!i.ok){const l=await i.json().catch(()=>({detail:`HTTP ${i.status}: ${i.statusText}`}));let g="Login failed";throw Array.isArray(l.detail)?g=l.detail.map(f=>f.msg).join(", "):typeof l.detail=="string"&&(g=l.detail),d.error(g),new Error(g)}return await i.json()},logout:()=>s.post("/auth/logout"),getCurrentUser:()=>s.get("/auth/me"),changePassword:(e,t)=>s.post("/auth/change-password",{current_password:e,new_password:t}),getUsers:async(e=0,t=100)=>{const r=await s.get(`/auth/users?skip=${e}&limit=${t}`);return{items:r,total:r.length,page:Math.floor(e/t)+1,size:t}},createUser:e=>s.post("/auth/users",e),getUser:e=>s.get(`/auth/users/${e}`),updateUser:(e,t)=>s.put(`/auth/users/${e}`,t),deleteUser:e=>s.delete(`/auth/users/${e}`)},$e={getProducts:(e=1,t=10)=>s.get(`/products?page=${e}&size=${t}`),getProduct:e=>s.get(`/products/${e}`),createProduct:e=>s.post("/products",e),updateProduct:(e,t)=>s.put(`/products/${e}`,t),deleteProduct:e=>s.delete(`/products/${e}`)},Te={getPlans:(e=1,t=10,r)=>{const n=new URLSearchParams({page:e.toString(),size:t.toString()});return r&&n.append("product_id",r),s.get(`/plans?${n.toString()}`)},getPlan:e=>s.get(`/plans/${e}`),createPlan:e=>s.post("/plans",e),updatePlan:(e,t)=>s.put(`/plans/${e}`,t),deletePlan:e=>s.delete(`/plans/${e}`)},be={getFeatures:(e=1,t=10,r)=>{const n=new URLSearchParams({page:e.toString(),size:t.toString()});return r&&n.append("product_id",r),s.get(`/features?${n.toString()}`)},getFeature:e=>s.get(`/features/${e}`),createFeature:e=>s.post("/features",e),updateFeature:(e,t)=>s.put(`/features/${e}`,t),deleteFeature:e=>s.delete(`/features/${e}`)},Se={getSubscriptions:(e=1,t=10,r)=>{const n=new URLSearchParams({page:e.toString(),size:t.toString()});return r&&n.append("tenant_id",r),s.get(`/subscriptions?${n.toString()}`)},getSubscription:e=>s.get(`/subscriptions/${e}`),createSubscription:e=>s.post("/subscriptions",e),updateSubscription:(e,t)=>s.put(`/subscriptions/${e}`,t),deleteSubscription:e=>s.delete(`/subscriptions/${e}`),getSubscriptionEntitlements:e=>s.get(`/subscriptions/${e}/entitlements`)},ke={check:()=>s.get("/health"),metrics:()=>s.get("/metrics")};export{s as a,$e as b,ye as c,we as d,ce as e,be as f,ge as g,ke as h,W as i,fe as j,le as k,me as l,pe as m,de as n,ue as o,Te as p,Se as s,d as t,he as u};
